name: Master Deployment Trigger

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Select environment to deploy'
        required: true
        default: 'test'
        type: choice
        options:
          - test
          - prod

jobs:
  trigger-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Call environment-specific workflow
        uses: actions/github-script@v6
        with:
          script: |
            const env = '${{ github.event.inputs.environment }}';
            const workflow = env === 'prod' ? 'deploy-prod.yml' : 'deploy-test.yml';

            github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: workflow,
              ref: 'main',
              inputs: {}
            });
